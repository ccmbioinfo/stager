"""using tables for dataset types

Revision ID: 504637ea7e26
Revises: 00462e44baf0
Create Date: 2020-10-30 17:00:27.627085

"""
from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import mysql

# revision identifiers, used by Alembic.
revision = "504637ea7e26"
down_revision = "00462e44baf0"
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table(
        "dataset_type",
        sa.Column("dataset_type", sa.String(length=50), nullable=False),
        sa.PrimaryKeyConstraint("dataset_type"),
    )
    op.create_table(
        "metadataset_type",
        sa.Column("metadataset_type", sa.String(length=50), nullable=False),
        sa.PrimaryKeyConstraint("metadataset_type"),
    )
    op.create_table(
        "metadataset_type_dataset_type",
        sa.Column("dataset_type", sa.String(length=50), nullable=False),
        sa.Column("metadataset_type", sa.String(length=50), nullable=False),
        sa.ForeignKeyConstraint(
            ["dataset_type"],
            ["dataset_type.dataset_type"],
        ),
        sa.ForeignKeyConstraint(
            ["metadataset_type"],
            ["metadataset_type.metadataset_type"],
        ),
        sa.PrimaryKeyConstraint("dataset_type", "metadataset_type"),
        sa.UniqueConstraint("dataset_type"),
    )

    op.drop_column("dataset", "dataset_type")
    op.add_column(
        "dataset", sa.Column("dataset_type", sa.String(length=50), nullable=False)
    )
    op.create_foreign_key(
        None, "dataset", "dataset_type", ["dataset_type"], ["dataset_type"]
    )
    op.add_column(
        "pipeline_datasets",
        sa.Column("supported_metadataset_type", sa.String(length=50), nullable=False),
    )
    op.create_foreign_key(
        None,
        "pipeline_datasets",
        "metadataset_type",
        ["supported_metadataset_type"],
        ["metadataset_type"],
    )
    op.drop_column("pipeline_datasets", "supported_dataset")
    op.add_column("user", sa.Column("deactivated", sa.Boolean(), nullable=False))
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_column("user", "deactivated")
    op.add_column(
        "pipeline_datasets",
        sa.Column(
            "supported_dataset",
            mysql.ENUM(
                "CES",
                "CGS",
                "CPS",
                "RES",
                "RGS",
                "RLM",
                "RMM",
                "RRS",
                "RTA",
                "WES",
                "WGS",
                "RNASeq",
                "RCS",
                "RDC",
                "RDE",
            ),
            nullable=False,
        ),
    )
    op.drop_constraint(None, "pipeline_datasets", type_="foreignkey")
    op.drop_column("pipeline_datasets", "supported_metadataset_type")
    op.drop_constraint(None, "dataset", type_="foreignkey")
    op.drop_table("metadataset_type_dataset_type")
    op.drop_table("metadataset_type")
    op.drop_table("dataset_type")
    # ### end Alembic commands ###
